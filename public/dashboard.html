<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MMS â€” Lead Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
:root {
  --black: #0a0804;
  --mustard-300: #FFE082;
  --mustard-400: #E6C84A;
  --mustard-500: #C8A415;
  --mustard-600: #A68B10;
}
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'DM Sans',sans-serif; background:var(--black); color:#fff; min-height:100vh; }
.font-mono { font-family:'JetBrains Mono',monospace; }
#gate { display:flex; align-items:center; justify-content:center; min-height:100vh; padding:24px; }
.gate-card { background:rgba(10,10,10,0.6); backdrop-filter:blur(12px); border:1px solid rgba(255,255,255,0.04); border-radius:20px; padding:48px; max-width:400px; width:100%; text-align:center; }
.gate-card h1 { font-size:24px; font-weight:800; margin-bottom:8px; background:linear-gradient(135deg, #A68B10, #E6C84A, #C8A415, #FFE082); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
.gate-card .sub { font-size:12px; color:rgba(255,255,255,0.3); margin-bottom:32px; letter-spacing:0.05em; }
.gate-input { width:100%; padding:14px 16px; background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.06); border-radius:10px; color:#fff; font-size:14px; font-family:'DM Sans',sans-serif; outline:none; transition:border-color 0.3s; margin-bottom:16px; }
.gate-input:focus { border-color:rgba(200,164,21,0.4); }
.gate-input::placeholder { color:rgba(255,255,255,0.15); }
.gate-btn { width:100%; padding:14px; border:none; border-radius:10px; cursor:pointer; font-size:12px; font-weight:700; text-transform:uppercase; letter-spacing:0.15em; color:#000; background:linear-gradient(to right, var(--mustard-500), var(--mustard-400)); transition:all 0.3s; }
.gate-btn:hover { box-shadow:0 0 30px rgba(200,164,21,0.25); }
.gate-error { color:#ef4444; font-size:12px; margin-top:12px; display:none; }
#dashboard { display:none; padding:24px; max-width:1280px; margin:0 auto; }
.dash-header { display:flex; justify-content:space-between; align-items:center; padding:24px 0 32px; border-bottom:1px solid rgba(255,255,255,0.04); margin-bottom:32px; }
.dash-header h1 { font-size:20px; font-weight:800; background:linear-gradient(135deg, #A68B10, #E6C84A, #C8A415, #FFE082); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
.dash-header .logout { padding:8px 16px; font-size:10px; text-transform:uppercase; letter-spacing:0.15em; font-weight:700; color:rgba(255,255,255,0.3); background:none; border:1px solid rgba(255,255,255,0.06); border-radius:999px; cursor:pointer; transition:all 0.3s; }
.dash-header .logout:hover { border-color:rgba(255,255,255,0.15); color:rgba(255,255,255,0.6); }
.stats-row { display:grid; grid-template-columns:repeat(4,1fr); gap:12px; margin-bottom:32px; }
@media(max-width:640px) { .stats-row { grid-template-columns:repeat(2,1fr); } }
.stat-box { background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.04); border-radius:14px; padding:20px; text-align:center; }
.stat-box .num { font-size:28px; font-weight:800; background:linear-gradient(135deg, #A68B10, #E6C84A); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
.stat-box .label { font-size:9px; text-transform:uppercase; letter-spacing:0.2em; color:rgba(255,255,255,0.3); margin-top:4px; font-weight:600; }
.filters { display:flex; gap:8px; margin-bottom:24px; flex-wrap:wrap; }
.filter-btn { padding:8px 16px; font-size:10px; text-transform:uppercase; letter-spacing:0.15em; font-weight:600; border-radius:999px; border:1px solid rgba(255,255,255,0.06); background:none; color:rgba(255,255,255,0.35); cursor:pointer; transition:all 0.3s; }
.filter-btn:hover { border-color:rgba(255,255,255,0.15); color:rgba(255,255,255,0.55); }
.filter-btn.active { border-color:rgba(200,164,21,0.5); background:rgba(200,164,21,0.1); color:var(--mustard-400); }
.leads-list { display:flex; flex-direction:column; gap:12px; }
.lead-card { background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.04); border-radius:14px; padding:24px; transition:all 0.3s; cursor:pointer; animation: fadeIn 0.3s ease both; }
.lead-card:hover { background:rgba(255,255,255,0.03); border-color:rgba(200,164,21,0.15); }
.lead-top { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:12px; }
.lead-name { font-size:16px; font-weight:700; color:#fff; }
.lead-email { font-size:12px; color:rgba(200,164,21,0.7); margin-top:2px; }
.lead-phone { font-size:11px; color:rgba(255,255,255,0.3); font-family:'JetBrains Mono',monospace; }
.lead-date { font-size:10px; color:rgba(255,255,255,0.2); font-family:'JetBrains Mono',monospace; }
.status-badge { display:inline-flex; padding:4px 12px; border-radius:999px; font-size:9px; text-transform:uppercase; letter-spacing:0.15em; font-family:'JetBrains Mono',monospace; font-weight:700; }
.status-new { background:rgba(59,130,246,0.1); color:#60a5fa; border:1px solid rgba(59,130,246,0.2); }
.status-contacted { background:rgba(200,164,21,0.1); color:var(--mustard-400); border:1px solid rgba(200,164,21,0.2); }
.status-booked { background:rgba(34,197,94,0.1); color:#4ade80; border:1px solid rgba(34,197,94,0.2); }
.status-closed { background:rgba(255,255,255,0.04); color:rgba(255,255,255,0.3); border:1px solid rgba(255,255,255,0.06); }
.lead-interest { display:inline-flex; padding:4px 10px; border-radius:999px; font-size:9px; text-transform:uppercase; letter-spacing:0.1em; font-family:'JetBrains Mono',monospace; font-weight:600; background:rgba(200,164,21,0.05); color:rgba(200,164,21,0.5); border:1px solid rgba(200,164,21,0.1); margin-right:6px; margin-bottom:4px; }
.lead-summary { font-size:13px; color:rgba(255,255,255,0.4); line-height:1.7; font-weight:300; margin-top:12px; }
.lead-actions { display:flex; gap:8px; margin-top:16px; flex-wrap:wrap; }
.action-btn { padding:6px 14px; font-size:9px; text-transform:uppercase; letter-spacing:0.15em; font-weight:700; border-radius:999px; cursor:pointer; transition:all 0.3s; border:1px solid; }
.action-btn.mark-contacted { background:rgba(200,164,21,0.1); color:var(--mustard-400); border-color:rgba(200,164,21,0.2); }
.action-btn.mark-contacted:hover { background:rgba(200,164,21,0.2); }
.action-btn.mark-booked { background:rgba(34,197,94,0.1); color:#4ade80; border-color:rgba(34,197,94,0.2); }
.action-btn.mark-booked:hover { background:rgba(34,197,94,0.2); }
.action-btn.mark-closed { background:rgba(255,255,255,0.04); color:rgba(255,255,255,0.3); border-color:rgba(255,255,255,0.06); }
.action-btn.mark-closed:hover { background:rgba(255,255,255,0.08); }
.transcript-toggle { font-size:10px; color:rgba(200,164,21,0.5); cursor:pointer; margin-top:12px; text-transform:uppercase; letter-spacing:0.1em; font-weight:600; transition:color 0.3s; background:none; border:none; font-family:'DM Sans',sans-serif; }
.transcript-toggle:hover { color:var(--mustard-400); }
.transcript-box { display:none; margin-top:12px; padding:16px; border-radius:10px; background:rgba(0,0,0,0.3); border:1px solid rgba(255,255,255,0.04); font-size:12px; color:rgba(255,255,255,0.35); line-height:1.8; font-family:'JetBrains Mono',monospace; max-height:300px; overflow-y:auto; white-space:pre-wrap; }
.empty-state { text-align:center; padding:80px 24px; color:rgba(255,255,255,0.2); font-size:14px; }
.empty-state .icon { font-size:48px; margin-bottom:16px; }
.refresh-btn { padding:8px 16px; font-size:10px; text-transform:uppercase; letter-spacing:0.15em; font-weight:700; color:var(--mustard-400); background:none; border:1px solid rgba(200,164,21,0.2); border-radius:999px; cursor:pointer; transition:all 0.3s; }
.refresh-btn:hover { background:rgba(200,164,21,0.1); }
@keyframes fadeIn { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)} }
</style>
</head>
<body>
<div id="gate">
  <div class="gate-card">
    <h1>Modern Mustard Seed</h1>
    <p class="sub">Lead Dashboard</p>
    <input type="password" class="gate-input" id="passwordInput" placeholder="Enter password" onkeydown="if(event.key==='Enter')checkPassword()">
    <button class="gate-btn" onclick="checkPassword()">Access Dashboard</button>
    <p class="gate-error" id="gateError">Incorrect password. Try again.</p>
  </div>
</div>
<div id="dashboard">
  <div class="dash-header">
    <div>
      <h1>Lead Dashboard</h1>
      <p style="font-size:11px;color:rgba(255,255,255,0.2);margin-top:4px;" class="font-mono">Modern Mustard Seed â€” Olivia's Leads</p>
    </div>
    <div style="display:flex;gap:8px;align-items:center;">
      <button class="refresh-btn" onclick="loadLeads()">â†» Refresh</button>
      <button class="dash-header logout" onclick="logout()">Logout</button>
    </div>
  </div>
  <div class="stats-row">
    <div class="stat-box"><div class="num" id="totalCount">0</div><div class="label">Total Leads</div></div>
    <div class="stat-box"><div class="num" id="newCount">0</div><div class="label">New</div></div>
    <div class="stat-box"><div class="num" id="bookedCount">0</div><div class="label">Booked</div></div>
    <div class="stat-box"><div class="num" id="thisWeekCount">0</div><div class="label">This Week</div></div>
  </div>
  <div class="filters">
    <button class="filter-btn active" onclick="setFilter('all',this)">All</button>
    <button class="filter-btn" onclick="setFilter('new',this)">New</button>
    <button class="filter-btn" onclick="setFilter('contacted',this)">Contacted</button>
    <button class="filter-btn" onclick="setFilter('booked',this)">Booked</button>
    <button class="filter-btn" onclick="setFilter('closed',this)">Closed</button>
  </div>
  <div class="leads-list" id="leadsList">
    <div class="empty-state"><div class="icon">ðŸŒ±</div><p>No leads yet. Once Olivia starts taking calls, they'll appear here.</p></div>
  </div>
</div>
<script>
const SUPABASE_URL = 'https://ykadnbgxavuisfjtxsrr.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlrYWRuYmd4YXZ1aXNmanR4c3JyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA0MTM5MTQsImV4cCI6MjA4NTk4OTkxNH0.HCwtX2mArD6bNfsoDpH0HYI0J0o4SyLzYhRjahPE7D8';
const DASHBOARD_PASSWORD = 'Easton12!!';
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
let allLeads = [];
let currentFilter = 'all';

function checkPassword() {
  const input = document.getElementById('passwordInput').value;
  if (input === DASHBOARD_PASSWORD) {
    sessionStorage.setItem('mms_dash_auth', 'true');
    document.getElementById('gate').style.display = 'none';
    document.getElementById('dashboard').style.display = 'block';
    loadLeads();
  } else {
    document.getElementById('gateError').style.display = 'block';
    document.getElementById('passwordInput').value = '';
    document.getElementById('passwordInput').focus();
  }
}

function logout() {
  sessionStorage.removeItem('mms_dash_auth');
  document.getElementById('gate').style.display = 'flex';
  document.getElementById('dashboard').style.display = 'none';
  document.getElementById('passwordInput').value = '';
}

if (sessionStorage.getItem('mms_dash_auth') === 'true') {
  document.getElementById('gate').style.display = 'none';
  document.getElementById('dashboard').style.display = 'block';
  loadLeads();
}

async function loadLeads() {
  try {
    const { data, error } = await supabase.from('leads').select('*').order('created_at', { ascending: false });
    if (error) throw error;
    allLeads = data || [];
    updateStats();
    renderLeads();
  } catch (err) { console.error('Error loading leads:', err); }
}

function updateStats() {
  const now = new Date();
  const weekAgo = new Date(now.getTime() - 7*24*60*60*1000);
  document.getElementById('totalCount').textContent = allLeads.length;
  document.getElementById('newCount').textContent = allLeads.filter(l => l.status === 'new').length;
  document.getElementById('bookedCount').textContent = allLeads.filter(l => l.status === 'booked').length;
  document.getElementById('thisWeekCount').textContent = allLeads.filter(l => new Date(l.created_at) >= weekAgo).length;
}

function setFilter(status, btn) {
  currentFilter = status;
  document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  renderLeads();
}

function renderLeads() {
  const filtered = currentFilter === 'all' ? allLeads : allLeads.filter(l => l.status === currentFilter);
  const list = document.getElementById('leadsList');
  if (filtered.length === 0) {
    list.innerHTML = `<div class="empty-state"><div class="icon">ðŸŒ±</div><p>${currentFilter === 'all' ? "No leads yet. Once Olivia starts taking calls, they'll appear here." : 'No ' + currentFilter + ' leads right now.'}</p></div>`;
    return;
  }
  list.innerHTML = filtered.map((lead) => {
    const date = new Date(lead.created_at);
    const dateStr = date.toLocaleDateString('en-US', { month:'short', day:'numeric', year:'numeric' });
    const timeStr = date.toLocaleTimeString('en-US', { hour:'numeric', minute:'2-digit' });
    const duration = lead.call_duration ? Math.floor(lead.call_duration/60) + 'm ' + (lead.call_duration%60) + 's' : '';
    return '<div class="lead-card" id="lead-' + lead.id + '">' +
      '<div class="lead-top"><div>' +
      '<div class="lead-name">' + (lead.name || 'Unknown Caller') + '</div>' +
      (lead.email ? '<div class="lead-email">' + lead.email + '</div>' : '') +
      (lead.phone ? '<div class="lead-phone">' + lead.phone + '</div>' : '') +
      '</div><div style="text-align:right;">' +
      '<span class="status-badge status-' + lead.status + '">' + lead.status + '</span>' +
      '<div class="lead-date" style="margin-top:8px;">' + dateStr + ' Â· ' + timeStr + '</div>' +
      (duration ? '<div class="lead-date">' + duration + '</div>' : '') +
      '</div></div>' +
      (lead.service_interest ? '<div style="margin-bottom:8px;">' + lead.service_interest.split(',').map(function(s) { return '<span class="lead-interest">' + s.trim() + '</span>'; }).join('') + '</div>' : '') +
      (lead.summary ? '<div class="lead-summary">' + lead.summary + '</div>' : '') +
      '<div class="lead-actions">' +
      (lead.status !== 'contacted' ? '<button class="action-btn mark-contacted" onclick="updateStatus(\'' + lead.id + '\',\'contacted\')">Mark Contacted</button>' : '') +
      (lead.status !== 'booked' ? '<button class="action-btn mark-booked" onclick="updateStatus(\'' + lead.id + '\',\'booked\')">Mark Booked</button>' : '') +
      (lead.status !== 'closed' ? '<button class="action-btn mark-closed" onclick="updateStatus(\'' + lead.id + '\',\'closed\')">Close</button>' : '') +
      '</div>' +
      (lead.transcript ? '<button class="transcript-toggle" onclick="toggleTranscript(\'' + lead.id + '\')">â–¸ View Transcript</button><div class="transcript-box" id="transcript-' + lead.id + '">' + lead.transcript + '</div>' : '') +
      '</div>';
  }).join('');
}

async function updateStatus(id, status) {
  try {
    const { error } = await supabase.from('leads').update({ status }).eq('id', id);
    if (error) throw error;
    const lead = allLeads.find(l => l.id === id);
    if (lead) lead.status = status;
    updateStats();
    renderLeads();
  } catch (err) { console.error('Error updating status:', err); }
}

function toggleTranscript(id) {
  const box = document.getElementById('transcript-' + id);
  box.style.display = box.style.display === 'block' ? 'none' : 'block';
}
</script>
</body>
</html>
